document.addEventListener("DOMContentLoaded",()=>{if(!document.querySelector("#dt_load_more_trigger"))return;let options={root:null,rootMargin:"0px",threshold:0};function handleIntersect(entries,observer){entries.forEach((entry)=>{if(entry.isIntersecting){var current=[];var items=document.querySelectorAll('.grid__item');items.forEach((el)=>{current.push(el.dataset.id);})
if(current.length==parseInt(document.querySelector("#dt_total").innerHTML)){observer.unobserve(document.getElementById("dt_load_more_trigger"));return;}
if(current.length<16)return false;loadmoreimg(current);}});}
function loadmoreimg(current=[],replace=false){let currentfilters={};filters.forEach((fltr)=>{if(!fltr.checked)return;if(!Array.isArray(currentfilters[fltr.dataset.filter]))currentfilters[fltr.dataset.filter]=[];currentfilters[fltr.dataset.filter].push(fltr.value);})
console.log('Loading...',currentfilters);const request=new XMLHttpRequest();request.open('POST',dt_ajax.ajaxurl,true);request.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');request.onload=function(){if(this.status>=200&&this.status<400){if(replace){document.querySelector("#dt_grid").innerHTML=this.response;}else{document.querySelector("#dt_grid").insertAdjacentHTML('beforeend',this.response);}
document.querySelector("#dt_current").innerHTML=document.querySelectorAll('.grid__item').length;}else{}};request.onerror=function(){};request.send('action=dt_load_more&current='+current.join(',')+'&filter='+JSON.stringify(currentfilters));}
let observer=new IntersectionObserver(handleIntersect,options);observer.observe(document.querySelector("#dt_load_more_trigger"));const locs=document.querySelectorAll('img[data-localization]');locs.forEach((loc)=>{loc.addEventListener('click',()=>{const lang=loc.dataset.localization;const container=document.querySelector(".dt_container");container.dataset.currentloc=lang;console.log(lang,container.dataset.currentloc)});})
const filters=document.querySelectorAll('[data-fitercontrol]');filters.forEach((filter)=>{filter.addEventListener('change',()=>{loadmoreimg([],true);});})
document.onclick=function(event){var el=event.target;if(el.closest('.grid__item')){const request=new XMLHttpRequest();request.open('POST',dt_ajax.ajaxurl,true);request.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');request.onload=function(){if(this.status>=200&&this.status<400){document.querySelector("#dt_modal").innerHTML=this.response;document.querySelector("#dt_modal").classList.add('show');}else{}};request.onerror=function(){};request.send('action=dt_load_modal&id='+el.closest('.grid__item').dataset.id);}else if(el.classList.contains('modal__close')){document.querySelector("#dt_modal").classList.remove('show');}else if(el.closest('.modal__inner')){}else{document.querySelector("#dt_modal").classList.remove('show');}};})